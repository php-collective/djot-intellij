{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Djot",
  "scopeName": "text.djot",
  "fileTypes": ["djot"],
  "patterns": [
    { "include": "#frontmatter" },
    { "include": "#comment-block" },
    { "include": "#heading" },
    { "include": "#codeblock-raw" },
    { "include": "#codeblock" },
    { "include": "#math-display" },
    { "include": "#blockquote" },
    { "include": "#div" },
    { "include": "#line-block" },
    { "include": "#definition-list" },
    { "include": "#list" },
    { "include": "#thematic-break" },
    { "include": "#table" },
    { "include": "#reference-definition" },
    { "include": "#footnote-definition" },
    { "include": "#block-attribute" },
    { "include": "#paragraph" }
  ],
  "repository": {
    "frontmatter": {
      "begin": "\\A(-{3})\\s*$",
      "end": "^(-{3})\\s*$",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.frontmatter.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.frontmatter.djot" }
      },
      "contentName": "markup.raw.yaml.frontmatter.djot"
    },
    "comment-block": {
      "begin": "^(\\{%)\\s*comment\\s*(%\\})\\s*$",
      "end": "^(\\{%)\\s*endcomment\\s*(%\\})\\s*$",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.comment.djot" },
        "2": { "name": "punctuation.definition.comment.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.comment.djot" },
        "2": { "name": "punctuation.definition.comment.djot" }
      },
      "name": "comment.block.djot"
    },
    "heading": {
      "patterns": [
        {
          "match": "^(#{1,6})\\s+(.*)$",
          "captures": {
            "1": { "name": "punctuation.definition.heading.djot markup.heading.marker.djot" },
            "2": {
              "name": "markup.heading.djot",
              "patterns": [{ "include": "#inline" }]
            }
          }
        }
      ]
    },
    "codeblock-raw": {
      "comment": "Raw code block with format specifier ```=html",
      "begin": "^(`{3,})=([a-zA-Z0-9_-]+)\\s*$",
      "end": "^(\\1)\\s*$",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.code.fence.djot" },
        "2": { "name": "entity.name.type.format.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.code.fence.djot" }
      },
      "contentName": "markup.raw.block.djot"
    },
    "codeblock": {
      "begin": "^(`{3,})([a-zA-Z0-9_+-]*)?(\\s*\\{[^}]*\\})?\\s*$",
      "end": "^(\\1)\\s*$",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.code.fence.djot" },
        "2": { "name": "entity.name.function.language.djot" },
        "3": { "name": "entity.other.attribute.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.code.fence.djot" }
      },
      "contentName": "markup.raw.code.fenced.djot",
      "patterns": [
        { "include": "#codeblock-inner" }
      ]
    },
    "codeblock-inner": {
      "match": ".+",
      "name": "markup.raw.code.djot"
    },
    "math-display": {
      "begin": "^(\\$\\$)(`?)\\s*$",
      "end": "^(\\1)\\s*$",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.math.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.math.end.djot" }
      },
      "contentName": "markup.math.display.djot"
    },
    "blockquote": {
      "begin": "^(>)\\s?",
      "while": "^(>)\\s?|^(?=\\s*$)",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.quote.djot" }
      },
      "patterns": [
        { "include": "#inline" }
      ],
      "name": "markup.quote.djot"
    },
    "div": {
      "begin": "^(:::+)\\s*(\\w[\\w-]*)?(\\s*\\{[^}]*\\})?\\s*$",
      "end": "^(\\1)\\s*$",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.div.begin.djot" },
        "2": { "name": "entity.name.tag.div.djot" },
        "3": { "name": "entity.other.attribute.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.div.end.djot" }
      },
      "patterns": [
        { "include": "$self" }
      ],
      "name": "markup.div.djot"
    },
    "line-block": {
      "match": "^(\\|)\\s(.*)$",
      "captures": {
        "1": { "name": "punctuation.definition.line-block.djot" },
        "2": {
          "patterns": [{ "include": "#inline" }]
        }
      },
      "name": "markup.line-block.djot"
    },
    "definition-list": {
      "patterns": [
        {
          "comment": "Definition term",
          "match": "^(:)\\s+(.+)$",
          "captures": {
            "1": { "name": "punctuation.definition.term.djot" },
            "2": {
              "name": "markup.bold.term.djot",
              "patterns": [{ "include": "#inline" }]
            }
          }
        }
      ]
    },
    "list": {
      "patterns": [
        {
          "comment": "Task list item",
          "match": "^(\\s*)(-|\\*|\\+|\\d+\\.|\\d+\\))\\s+(\\[[ xX]\\])\\s*",
          "captures": {
            "2": { "name": "punctuation.definition.list.marker.djot" },
            "3": { "name": "punctuation.definition.checkbox.djot keyword.control.checkbox.djot" }
          }
        },
        {
          "comment": "Unordered/ordered list item",
          "match": "^(\\s*)(-|\\*|\\+|\\d+\\.|\\d+\\))\\s+",
          "captures": {
            "2": { "name": "punctuation.definition.list.marker.djot" }
          }
        }
      ]
    },
    "thematic-break": {
      "match": "^(\\*{3,}|-{3,})\\s*$",
      "name": "markup.separator.thematic-break.djot"
    },
    "table": {
      "patterns": [
        {
          "comment": "Table caption",
          "match": "^(\\^)\\s+(.*)$",
          "captures": {
            "1": { "name": "punctuation.definition.caption.djot" },
            "2": {
              "name": "markup.italic.caption.djot",
              "patterns": [{ "include": "#inline" }]
            }
          }
        },
        {
          "comment": "Table separator row",
          "match": "^\\|[\\s|:=-]+\\|\\s*$",
          "name": "punctuation.definition.table.separator.djot"
        },
        {
          "comment": "Table row",
          "begin": "^(\\|)",
          "end": "(\\|)(\\s*\\{[^}]*\\})?\\s*$",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.table.pipe.djot" }
          },
          "endCaptures": {
            "1": { "name": "punctuation.definition.table.pipe.djot" },
            "2": { "name": "entity.other.attribute.djot" }
          },
          "patterns": [
            { "include": "#table-cell" }
          ],
          "name": "markup.table.row.djot"
        }
      ]
    },
    "table-cell": {
      "patterns": [
        {
          "comment": "Header cell marker",
          "match": "(=)([<>~])?",
          "captures": {
            "1": { "name": "punctuation.definition.table.header.djot" },
            "2": { "name": "punctuation.definition.table.alignment.djot" }
          }
        },
        {
          "comment": "Cell separator",
          "match": "\\|",
          "name": "punctuation.definition.table.pipe.djot"
        },
        { "include": "#inline" }
      ]
    },
    "reference-definition": {
      "match": "^(\\[)([^\\]]+)(\\])(:)\\s*(.+)$",
      "captures": {
        "1": { "name": "punctuation.definition.reference.begin.djot" },
        "2": { "name": "entity.name.reference.djot" },
        "3": { "name": "punctuation.definition.reference.end.djot" },
        "4": { "name": "punctuation.separator.definition.djot" },
        "5": { "name": "markup.underline.link.djot" }
      }
    },
    "footnote-definition": {
      "match": "^(\\[\\^)([^\\]]+)(\\])(:)",
      "captures": {
        "1": { "name": "punctuation.definition.footnote.begin.djot" },
        "2": { "name": "entity.name.footnote.djot constant.other.footnote.djot" },
        "3": { "name": "punctuation.definition.footnote.end.djot" },
        "4": { "name": "punctuation.separator.definition.djot" }
      }
    },
    "block-attribute": {
      "match": "^(\\{)([^}]+)(\\})\\s*$",
      "captures": {
        "1": { "name": "punctuation.definition.attribute.begin.djot" },
        "2": {
          "patterns": [{ "include": "#attribute-content" }]
        },
        "3": { "name": "punctuation.definition.attribute.end.djot" }
      },
      "name": "entity.other.attribute.block.djot"
    },
    "attribute-content": {
      "patterns": [
        {
          "comment": "Class",
          "match": "(\\.)([\\w-]+)",
          "captures": {
            "1": { "name": "punctuation.definition.class.djot" },
            "2": { "name": "entity.other.attribute.class.djot" }
          }
        },
        {
          "comment": "ID",
          "match": "(#)([\\w-]+)",
          "captures": {
            "1": { "name": "punctuation.definition.id.djot" },
            "2": { "name": "entity.other.attribute.id.djot" }
          }
        },
        {
          "comment": "Key-value",
          "match": "([\\w-]+)(=)(\"[^\"]*\"|'[^']*'|[^\\s}]+)",
          "captures": {
            "1": { "name": "entity.other.attribute.name.djot" },
            "2": { "name": "punctuation.separator.key-value.djot" },
            "3": { "name": "string.quoted.attribute.value.djot" }
          }
        }
      ]
    },
    "paragraph": {
      "begin": "^(?=\\S)",
      "end": "^\\s*$",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "inline": {
      "patterns": [
        { "include": "#escape" },
        { "include": "#raw-inline" },
        { "include": "#code-inline" },
        { "include": "#math-inline" },
        { "include": "#autolink" },
        { "include": "#image" },
        { "include": "#link" },
        { "include": "#footnote-ref" },
        { "include": "#span" },
        { "include": "#strong" },
        { "include": "#emphasis" },
        { "include": "#highlight" },
        { "include": "#insert" },
        { "include": "#delete" },
        { "include": "#superscript" },
        { "include": "#subscript" },
        { "include": "#symbol" },
        { "include": "#smart-punctuation" },
        { "include": "#hard-break" },
        { "include": "#inline-attribute" }
      ]
    },
    "escape": {
      "match": "\\\\.",
      "name": "constant.character.escape.djot"
    },
    "raw-inline": {
      "comment": "Raw inline with format `=html content`",
      "match": "(`+)(=)([a-zA-Z0-9_-]+)\\s([^`]+)(\\1)",
      "captures": {
        "1": { "name": "punctuation.definition.raw.begin.djot" },
        "2": { "name": "punctuation.definition.raw.format.djot" },
        "3": { "name": "entity.name.type.format.djot" },
        "4": { "name": "markup.raw.inline.djot" },
        "5": { "name": "punctuation.definition.raw.end.djot" }
      }
    },
    "code-inline": {
      "match": "(`+)([^`]+)(\\1)",
      "captures": {
        "1": { "name": "punctuation.definition.code.begin.djot" },
        "2": { "name": "markup.raw.inline.code.djot" },
        "3": { "name": "punctuation.definition.code.end.djot" }
      }
    },
    "math-inline": {
      "match": "(\\$`)([^`]+)(`)",
      "captures": {
        "1": { "name": "punctuation.definition.math.begin.djot" },
        "2": { "name": "markup.math.inline.djot" },
        "3": { "name": "punctuation.definition.math.end.djot" }
      }
    },
    "autolink": {
      "match": "(<)(https?://[^>]+|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})(>)",
      "captures": {
        "1": { "name": "punctuation.definition.autolink.begin.djot" },
        "2": { "name": "markup.underline.link.autolink.djot" },
        "3": { "name": "punctuation.definition.autolink.end.djot" }
      }
    },
    "image": {
      "match": "(!)?(\\[)([^\\]]*)(\\])(\\()([^)]*)(\\))",
      "captures": {
        "1": { "name": "punctuation.definition.image.marker.djot" },
        "2": { "name": "punctuation.definition.image.begin.djot" },
        "3": {
          "name": "string.other.image.alt.djot",
          "patterns": [{ "include": "#inline" }]
        },
        "4": { "name": "punctuation.definition.image.end.djot" },
        "5": { "name": "punctuation.definition.image.url.begin.djot" },
        "6": { "name": "markup.underline.link.image.djot" },
        "7": { "name": "punctuation.definition.image.url.end.djot" }
      }
    },
    "link": {
      "match": "(\\[)([^\\]]+)(\\])(\\()([^)]*)(\\))",
      "captures": {
        "1": { "name": "punctuation.definition.link.begin.djot" },
        "2": {
          "name": "string.other.link.title.djot",
          "patterns": [{ "include": "#inline" }]
        },
        "3": { "name": "punctuation.definition.link.end.djot" },
        "4": { "name": "punctuation.definition.link.url.begin.djot" },
        "5": { "name": "markup.underline.link.djot" },
        "6": { "name": "punctuation.definition.link.url.end.djot" }
      }
    },
    "footnote-ref": {
      "match": "(\\[\\^)([^\\]]+)(\\])",
      "captures": {
        "1": { "name": "punctuation.definition.footnote.begin.djot" },
        "2": { "name": "constant.other.footnote.reference.djot" },
        "3": { "name": "punctuation.definition.footnote.end.djot" }
      }
    },
    "span": {
      "comment": "Span with optional attributes [text]{.class}",
      "match": "(\\[)([^\\]]+)(\\])(\\{)([^}]*)(\\})",
      "captures": {
        "1": { "name": "punctuation.definition.span.begin.djot" },
        "2": {
          "name": "markup.span.djot",
          "patterns": [{ "include": "#inline" }]
        },
        "3": { "name": "punctuation.definition.span.end.djot" },
        "4": { "name": "punctuation.definition.attribute.begin.djot" },
        "5": {
          "patterns": [{ "include": "#attribute-content" }]
        },
        "6": { "name": "punctuation.definition.attribute.end.djot" }
      }
    },
    "strong": {
      "begin": "(\\*)",
      "end": "(\\*)",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.bold.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.bold.end.djot" }
      },
      "name": "markup.bold.djot",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "emphasis": {
      "begin": "(_)",
      "end": "(_)",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.italic.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.italic.end.djot" }
      },
      "name": "markup.italic.djot",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "highlight": {
      "begin": "(\\{=)",
      "end": "(=\\})",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.highlight.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.highlight.end.djot" }
      },
      "name": "markup.highlight.djot",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "insert": {
      "begin": "(\\{\\+)",
      "end": "(\\+\\})",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.insert.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.insert.end.djot" }
      },
      "name": "markup.inserted.djot",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "delete": {
      "begin": "(\\{-)",
      "end": "(-\\})",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.delete.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.delete.end.djot" }
      },
      "name": "markup.deleted.djot",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "superscript": {
      "begin": "(\\{\\^)",
      "end": "(\\^\\})",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.superscript.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.superscript.end.djot" }
      },
      "name": "markup.superscript.djot",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "subscript": {
      "begin": "(\\{~)",
      "end": "(~\\})",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.subscript.begin.djot" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.subscript.end.djot" }
      },
      "name": "markup.subscript.djot",
      "patterns": [
        { "include": "#inline" }
      ]
    },
    "symbol": {
      "match": "(:)([a-zA-Z][\\w-]*)(:)",
      "captures": {
        "1": { "name": "punctuation.definition.symbol.begin.djot" },
        "2": { "name": "constant.character.symbol.djot" },
        "3": { "name": "punctuation.definition.symbol.end.djot" }
      }
    },
    "smart-punctuation": {
      "patterns": [
        {
          "comment": "Em dash",
          "match": "---",
          "name": "punctuation.dash.em.djot"
        },
        {
          "comment": "En dash",
          "match": "--",
          "name": "punctuation.dash.en.djot"
        },
        {
          "comment": "Ellipsis",
          "match": "\\.\\.\\.",
          "name": "punctuation.ellipsis.djot"
        },
        {
          "comment": "Left double quote",
          "match": "\"(?=\\S)",
          "name": "punctuation.definition.quote.begin.djot"
        },
        {
          "comment": "Right double quote",
          "match": "(?<=\\S)\"",
          "name": "punctuation.definition.quote.end.djot"
        },
        {
          "comment": "Left single quote / apostrophe",
          "match": "'(?=\\S)",
          "name": "punctuation.definition.quote.single.begin.djot"
        },
        {
          "comment": "Right single quote / apostrophe",
          "match": "(?<=\\S)'",
          "name": "punctuation.definition.quote.single.end.djot"
        }
      ]
    },
    "hard-break": {
      "match": "\\\\$",
      "name": "constant.character.escape.linebreak.djot"
    },
    "inline-attribute": {
      "match": "(\\{)([^}]+)(\\})",
      "captures": {
        "1": { "name": "punctuation.definition.attribute.begin.djot" },
        "2": {
          "patterns": [{ "include": "#attribute-content" }]
        },
        "3": { "name": "punctuation.definition.attribute.end.djot" }
      }
    }
  }
}
